<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prototipo App Formación Bíblica v6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Variables y estilos base Discord-like */
        :root {
            --bg-dark: #2f3136;
            --bg-sidebar: #202225;
            --bg-card: #36393f;
            --bg-input: #40444b;
            --bg-primary: #5865f2;
            --bg-secondary: #4f545c;
            --text-primary: #ffffff;
            --text-secondary: #b9bbbe;
            --text-muted: #72767d;
            --border-color: #4f545c; /* Color de borde más definido */
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
        }
        /* Componentes Discord-like */
        .discord-sidebar { background-color: var(--bg-sidebar); }
        .discord-card { background-color: var(--bg-card); border: 1px solid var(--border-color); } /* Borde añadido */
        .discord-input { background-color: var(--bg-input); border: 1px solid var(--border-color); }
        .discord-button-primary { background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.2s; }
        .discord-button-primary:hover { background-color: #4752c4; }
        .discord-button-secondary { background-color: var(--bg-secondary); color: var(--text-secondary); transition: background-color 0.2s; }
        .discord-button-secondary:hover { background-color: #5d6269; }
        .discord-text-secondary { color: var(--text-secondary); }
        .discord-text-muted { color: var(--text-muted); }
        .discord-link { color: #00a8fc; cursor: pointer; }
        .discord-link:hover { text-decoration: underline; }

        /* Navegación */
        .nav-button { color: var(--text-secondary); transition: background-color 0.2s, color 0.2s; }
        .nav-button.active { background-color: #393c43; color: var(--text-primary); }
        .nav-button:hover:not(.active) { background-color: #36393f; }
        .tab-button { border-bottom: 3px solid transparent; color: var(--text-secondary); padding-bottom: 0.5rem; margin-bottom: -1px; transition: border-color 0.2s, color 0.2s; }
        .tab-button.active { border-bottom-color: var(--bg-primary); color: var(--text-primary); font-weight: 500; }
        .tab-button:hover:not(.active) { border-bottom-color: var(--bg-secondary); color: var(--text-primary); }
        .tab-nav-container { overflow-x: auto; white-space: nowrap; border-bottom: 1px solid var(--border-color); }
        .tab-nav-container::-webkit-scrollbar { height: 4px; }
        .tab-nav-container::-webkit-scrollbar-thumb { background: var(--bg-primary); border-radius: 2px; }
        .tab-nav-container::-webkit-scrollbar-track { background: var(--bg-input); }

        /* Breadcrumbs */
        .breadcrumbs { color: var(--text-muted); }
        .breadcrumbs-item:not(:last-child)::after { content: '/'; margin: 0 0.5rem; color: var(--text-muted); }
        .breadcrumb-link { color: var(--text-secondary); cursor: pointer; }
        .breadcrumb-link:hover { color: var(--text-primary); }
        .breadcrumb-current { color: var(--text-primary); font-weight: 500; }

        /* Sistema Agua */
        .agua-columna { background-color: rgba(0,0,0,0.1); border: 1px dashed var(--border-color); min-height: 250px; display: flex; flex-direction: column;}
        .agua-elementos-container { flex-grow: 1; padding: 0.5rem; } /* Contenedor para elementos */
        .agua-elemento { background-color: var(--bg-secondary); padding: 0.5rem 0.75rem; border-radius: 0.375rem; margin-bottom: 0.5rem; cursor: pointer; border: 1px solid transparent; transition: border-color 0.2s; }
        .agua-elemento:hover { border-color: var(--bg-primary); }
        /* Clases para drag and drop (si se implementa con JS) */
        .elemento-ghost { opacity: 0.4; background: #4752c4; }
        .elemento-chosen { /* Estilo cuando se selecciona */ }
        .elemento-drag { /* Estilo mientras se arrastra */ }

        /* Filtros Analíticos */
        .filtro-card { border: 1px solid var(--border-color); border-radius: 0.5rem; margin-bottom: 0.5rem; background-color: var(--bg-card); overflow: hidden;} /* Overflow hidden para bordes */
        .filtro-header { background-color: var(--bg-input); padding: 0.75rem 1rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background-color 0.2s; }
        .filtro-header:hover { background-color: #4f545c; }
        .filtro-header .lucide-chevron-down { transition: transform 0.3s ease; }
        .filtro-header.expanded .lucide-chevron-down { transform: rotate(180deg); }
        .filtro-content { padding: 1rem; border-top: 1px solid var(--border-color); max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out, padding 0.5s ease-out; }
        .filtro-content.expanded { max-height: 1000px; /* Valor grande para permitir expansión */ padding: 1rem; } /* Ajustar padding en expansión */
        .filtro-subcategoria { margin-left: 1rem; margin-top: 0.5rem; }

        /* Vista Detalle Filtro (Placeholder) */
        #filter-detail-view { border: 1px solid var(--border-color); border-radius: 0.5rem; background-color: var(--bg-card); }
        .filter-detail-header { background-color: var(--bg-input); padding: 0.75rem 1rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .filter-detail-section { padding: 1rem; border-bottom: 1px solid var(--border-color); }
        .filter-detail-section:last-child { border-bottom: none; }

        /* Estilos Memorización */
        .highlight-correct { color: #43b581; font-weight: bold; }
        .highlight-incorrect { color: #f04747; text-decoration: line-through; font-weight: bold; }
        .highlight-missing { color: #faa61a; font-style: italic; background-color: rgba(250, 166, 26, 0.1); padding: 0 2px; border-radius: 3px;}

        /* Responsividad Adicional */
        @media (max-width: 640px) { /* Ajuste para sm */
            .discord-sidebar { width: 100%; height: auto; flex-direction: row; justify-content: space-around; position: fixed; bottom: 0; left: 0; z-index: 50; border-top: 1px solid var(--border-color);}
            body { padding-bottom: 4rem; /* Espacio para la barra inferior */ }
            .nav-button { width: auto; height: auto; padding: 0.5rem; flex-grow: 1; }
            main { margin-left: 0; } /* Eliminar margen izquierdo en móvil */
            .agua-columna { min-height: 150px; }
        }
    </style>
</head>
<body class="discord-bg discord-text-primary flex flex-col sm:flex-row h-screen antialiased overflow-hidden">

    <aside class="discord-sidebar w-full sm:w-20 flex flex-row sm:flex-col items-center justify-around sm:justify-start py-2 sm:py-4 space-x-2 sm:space-x-0 sm:space-y-4 flex-shrink-0 sm:h-full">
        <button id="nav-inicio" title="Inicio" class="nav-button active p-2 sm:p-3 rounded-lg flex items-center justify-center">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-home"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        </button>
        <button id="nav-teoria" title="Teoría" class="nav-button p-2 sm:p-3 rounded-lg flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open-text"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/><path d="M6 8h2"/><path d="M6 12h2"/><path d="M16 8h2"/><path d="M16 12h2"/></svg>
        </button>
        <button id="nav-practica" title="Práctica" class="nav-button p-2 sm:p-3 rounded-lg flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-check"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="m9 14 2 2 4-4"/></svg>
        </button>
         <button id="nav-settings-placeholder" title="Ajustes" class="nav-button mt-auto hidden sm:flex p-3 rounded-lg w-14 h-14 items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        </button>
    </aside>

    <main class="flex-1 flex flex-col overflow-hidden">
        <header class="discord-card shadow-md p-3 md:p-4 flex justify-between items-center flex-shrink-0 border-b border-[var(--border-color)]">
            <div id="breadcrumbs-container" class="text-xs sm:text-sm hidden">
                <nav class="breadcrumbs flex items-center">
                    <span id="breadcrumb-path">
                        </span>
                </nav>
             </div>
             <h1 id="main-title" class="main-title-text text-base sm:text-lg md:text-xl font-semibold discord-text-primary truncate">Inicio</h1>

            <div class="header-controls flex items-center space-x-1 md:space-x-2">
                 <button id="social-general-btn" title="Social General" class="discord-button-secondary p-1 md:p-2 rounded-lg hidden">
                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                 </button>
                 <button id="social-teoria-btn" title="Social Teoría" class="discord-button-secondary p-1 md:p-2 rounded-lg hidden">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-graduation-cap"><path d="M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.084a1 1 0 0 0 0 1.838l8.57 3.908a2 2 0 0 0 1.66 0l8.59-3.908Z"/><path d="M6 12v5c0 1.66 4 3 6 3s6-1.34 6-3v-5"/></svg>
                 </button>
                  <button id="social-practica-btn" title="Social Práctica" class="discord-button-secondary p-1 md:p-2 rounded-lg hidden">
                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-check"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></svg>
                 </button>

                 <span class="discord-text-muted text-sm mx-1 md:mx-2">|</span>
                 <span class="discord-text-muted text-xs md:text-sm">RV1960</span>
                 <button title="Perfil / Ajustes" class="discord-button-secondary p-1 md:p-2 rounded-lg">
                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-cog"><circle cx="18" cy="15" r="3"/><circle cx="9" cy="7" r="4"/><path d="M10 15H6a4 4 0 0 0-4 4v2"/><path d="m21.7 16.4-.9-.3"/><path d="m15.2 13.9-.9-.3"/><path d="m16.6 18.7.3-.9"/><path d="m19.1 12.2.3-.9"/><path d="m19.6 18.7-.4-1"/><path d="m16.8 12.3-.4-1"/><path d="m14.3 16.6 1-.4"/><path d="m20.7 13.8 1-.4"/></svg>
                 </button>
                 <button id="toggle-breadcrumbs-btn" title="Mostrar/Ocultar Ruta" class="discord-button-secondary p-1 md:p-2 rounded-lg hidden">
                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-git-branch-plus"><line x1="6" x2="6" y1="3" y2="15"/><circle cx="18" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><path d="M18 9a9 9 0 0 1-9 9"/></svg>
                 </button>
            </div>
        </header>

        <div id="main-content-area" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-6">

            <div id="content-inicio" class="content-section">
                 <div class="discord-card rounded-lg p-4 md:p-6 shadow">
                    <h2 class="text-xl md:text-2xl font-semibold mb-4">Panel Principal</h2>
                    <p class="discord-text-secondary text-sm md:text-base">Bienvenido...</p>
                    <button id="show-checkin-modal" class="mt-4 px-4 py-2 rounded-lg discord-button-primary text-sm md:text-base">Iniciar Check-in Diario</button>
                    </div>
            </div>

            <div id="content-teoria" class="content-section hidden">
                <div class="border-b border-[var(--border-color)] mb-4 tab-nav-container">
                    <nav class="-mb-px flex space-x-4 md:space-x-6" aria-label="Tabs">
                        <button data-target="subcontent-lectura" class="tab-button active whitespace-nowrap py-3 px-2 font-medium text-xs sm:text-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open-text inline mr-1"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/><path d="M6 8h2"/><path d="M6 12h2"/><path d="M16 8h2"/><path d="M16 12h2"/></svg> Lectura
                        </button>
                         <button data-target="subcontent-memorizacion" class="tab-button whitespace-nowrap py-3 px-2 font-medium text-xs sm:text-sm">
                           <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-brain inline mr-1"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08.5.5 0 0 0-.8-.48A2.5 2.5 0 0 1 2.5 13V10A2.5 2.5 0 0 1 5 7.5V6A2.5 2.5 0 0 1 7.5 3.5a.5.5 0 0 0 .4-.8C8.4 2.2 8.9 2 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08.5.5 0 0 1 .8-.48A2.5 2.5 0 0 0 21.5 13V10A2.5 2.5 0 0 0 19 7.5V6A2.5 2.5 0 0 0 16.5 3.5a.5.5 0 0 1-.4-.8C15.6 2.2 15.1 2 14.5 2Z"/></svg> Memorización
                        </button>
                         <button data-target="subcontent-agua" class="tab-button whitespace-nowrap py-3 px-2 font-medium text-xs sm:text-sm">
                           <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-droplets inline mr-1"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.7-3.02C8.13 8.5 7 7.5 7 5.4c0-1.21.8-2.2 1.8-2.2.9 0 1.7.7 1.8 1.5"/><path d="m14 7.8-1.1 1.1"/><path d="M10.3 10.3 9.2 11.4"/><path d="M10.6 16.3c.1-.1.3-.2.4-.3.8-1 1.6-2.3 1.6-3.7 0-1.16-.57-2.26-1.7-3.02-1.14-.76-2.3-1.76-2.3-3.85 0-1.21.8-2.2 1.8-2.2.9 0 1.7.7 1.8 1.5"/></svg> Sistema Agua
                        </button>
                         <button data-target="subcontent-filtros" class="tab-button whitespace-nowrap py-3 px-2 font-medium text-xs sm:text-sm">
                           <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-filter inline mr-1"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg> Filtros Analíticos
                        </button>
                    </nav>
                </div>

                <div id="teoria-subcontent-container" class="space-y-6">
                    <div id="subcontent-lectura" class="subcontent visible">
                        <div class="discord-card rounded-lg p-4 md:p-6 shadow">
                            <h2 class="text-xl md:text-2xl font-semibold mb-4">Lectura Bíblica</h2>
                            <div class="border border-[var(--border-color)] rounded p-3 md:p-4 mt-4 bg-gray-800/30">
                                <p class="font-semibold text-md md:text-lg mb-2">Juan 3:16 (RV1960)</p>
                                <p class="discord-text-secondary text-sm md:text-base">Porque de tal manera amó Dios al mundo...</p>
                                <div class="mt-3 flex flex-wrap items-center gap-2 text-xs md:text-sm">
                                    <span class="discord-text-muted flex-shrink-0">Filtros:</span>
                                    <label class="flex items-center space-x-1 cursor-pointer p-1 rounded hover:bg-gray-700">
                                        <input type="checkbox" class="form-checkbox h-3 w-3 md:h-4 md:w-4 text-blue-500 bg-gray-700 border-gray-600 rounded focus:ring-blue-600">
                                        <span class="discord-text-secondary">Mantenencia</span>
                                    </label>
                                    <label class="flex items-center space-x-1 cursor-pointer p-1 rounded hover:bg-gray-700">
                                        <input type="checkbox" class="form-checkbox h-3 w-3 md:h-4 md:w-4 text-green-500 bg-gray-700 border-gray-600 rounded focus:ring-green-600">
                                        <span class="discord-text-secondary">Aumentancia</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="subcontent-memorizacion" class="subcontent hidden">
                         <div class="discord-card rounded-lg p-4 md:p-6 shadow">
                            <h2 class="text-xl md:text-2xl font-semibold mb-4">Memorización (SRS)</h2>
                            <div class="mt-4">
                                <h3 class="text-md md:text-lg font-semibold mb-1 discord-text-primary">Revisar Versículo:</h3>
                                <p id="citation" class="text-xl md:text-2xl font-bold mb-4 discord-link" title="Mostrar versículo completo">Juan 3:16</p>
                                <div class="mb-4">
                                    <label for="verseInput" class="block text-xs md:text-sm font-medium discord-text-secondary mb-1">Escribe el versículo de memoria:</label>
                                    <textarea id="verseInput" rows="4" class="w-full p-3 discord-input rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--bg-primary)] discord-text-primary text-sm md:text-base"></textarea>
                                </div>
                                <div class="flex justify-end space-x-2 md:space-x-3">
                                    <button id="revealBtn" class="px-3 py-1 md:px-4 md:py-2 rounded-lg discord-button-secondary text-xs md:text-sm">Mostrar</button>
                                    <button id="checkBtn" class="px-3 py-1 md:px-4 md:py-2 rounded-lg discord-button-primary text-xs md:text-sm">Comprobar</button>
                                </div>
                            </div>
                            <div id="resultArea" class="discord-card rounded-lg p-3 md:p-6 shadow hidden mt-6 bg-gray-800/20 border border-[var(--border-color)]/50">
                                 <h3 class="text-sm md:text-md font-semibold mb-2 discord-text-primary">Comparación:</h3>
                                 <div id="comparisonOutput" class="mb-4 p-2 md:p-3 border border-[var(--border-color)] rounded-md discord-text-secondary space-y-2 text-xs md:text-sm">
                                     <p><strong>Tu respuesta:</strong> <span id="userAnswer"></span></p>
                                     <p><strong>Correcto:</strong> <span id="correctAnswer"></span></p>
                                     <hr class="border-gray-600 my-2">
                                     <p><strong>Diferencias:</strong> <span id="diffOutput"></span></p>
                                 </div>
                                 <h3 class="text-sm md:text-md font-semibold mb-2 discord-text-primary">¿Qué tan fácil fue recordar? (SRS)</h3>
                                 <div class="flex flex-wrap gap-1 md:gap-2">
                                     <button class="flex-1 px-2 py-1 md:px-3 md:py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white text-xs md:text-sm srs-btn" data-rating="1">Otra vez</button>
                                     <button class="flex-1 px-2 py-1 md:px-3 md:py-2 rounded-lg bg-orange-500 hover:bg-orange-600 text-white text-xs md:text-sm srs-btn" data-rating="2">Difícil</button>
                                     <button class="flex-1 px-2 py-1 md:px-3 md:py-2 rounded-lg bg-blue-500 hover:bg-blue-600 text-white text-xs md:text-sm srs-btn" data-rating="3">Bien</button>
                                     <button class="flex-1 px-2 py-1 md:px-3 md:py-2 rounded-lg bg-green-600 hover:bg-green-700 text-white text-xs md:text-sm srs-btn" data-rating="4">Fácil</button>
                                 </div>
                                  <p id="srsFeedback" class="text-xs md:text-sm discord-text-muted mt-3"></p>
                            </div>
                        </div>
                    </div>

                     <div id="subcontent-agua" class="subcontent hidden">
                        <div class="discord-card rounded-lg p-4 md:p-6 shadow">
                            <h2 class="text-xl md:text-2xl font-semibold mb-4">Sistema Agua (Valor / Añadir / No Añadir)</h2>
                            <p class="discord-text-secondary text-sm md:text-base mb-4">Representación visual básica. Haz clic en (+) para añadir un elemento (simulado).</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="agua-columna border border-dashed border-[var(--border-color)] p-2 rounded flex flex-col">
                                    <h3 class="font-semibold text-center mb-2 sticky top-0 bg-[var(--bg-card)] py-1">Valor</h3>
                                    <div class="agua-elementos-container space-y-2 flex-grow overflow-y-auto">
                                        <div class="agua-elemento" data-id="v1">Elemento Valor 1</div>
                                        <div class="agua-elemento" data-id="v2">Elemento Valor 2</div>
                                        </div>
                                    <button class="add-agua-elemento-btn mt-2 discord-button-secondary text-xs py-1" data-columna="valor">+ Añadir</button>
                                </div>
                                 <div class="agua-columna border border-dashed border-[var(--border-color)] p-2 rounded flex flex-col">
                                    <h3 class="font-semibold text-center mb-2 sticky top-0 bg-[var(--bg-card)] py-1">Añadir</h3>
                                    <div class="agua-elementos-container space-y-2 flex-grow overflow-y-auto">
                                        <div class="agua-elemento" data-id="a1">Elemento Añadir A</div>
                                        <div class="agua-elemento" data-id="a2">Elemento Añadir B</div>
                                        </div>
                                     <button class="add-agua-elemento-btn mt-2 discord-button-secondary text-xs py-1" data-columna="anadir">+ Añadir</button>
                                </div>
                                 <div class="agua-columna border border-dashed border-[var(--border-color)] p-2 rounded flex flex-col">
                                    <h3 class="font-semibold text-center mb-2 sticky top-0 bg-[var(--bg-card)] py-1">No Añadir</h3>
                                   <div class="agua-elementos-container space-y-2 flex-grow overflow-y-auto">
                                        <div class="agua-elemento" data-id="n1">Elemento No Añadir X</div>
                                        </div>
                                     <button class="add-agua-elemento-btn mt-2 discord-button-secondary text-xs py-1" data-columna="no-anadir">+ Añadir</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="subcontent-filtros" class="subcontent hidden">
                        <div class="discord-card rounded-lg p-4 md:p-6 shadow">
                            <h2 class="text-xl md:text-2xl font-semibold mb-4">Filtros Analíticos Interactivos</h2>
                            <p class="discord-text-secondary text-sm md:text-base mb-4">Haz clic en un filtro para ver su detalle (simulado).</p>
                            <div id="filtros-lista-container" class="space-y-2">
                                </div>
                        </div>
                    </div>
                     <div id="subcontent-analisis-mant" class="subcontent hidden">
                        <div class="discord-card rounded-lg p-4 md:p-6 shadow">
                            <h2 class="text-xl md:text-2xl font-semibold mb-4">Análisis: Mantenencia</h2>
                            <p class="discord-text-secondary text-sm md:text-base">Exploración de Mantenencia Finita (Vivencia) e Infinita (Trascendencia).</p>
                        </div>
                    </div>
                     <div id="subcontent-analisis-aum" class="subcontent hidden">
                        <div class="discord-card rounded-lg p-4 md:p-6 shadow">
                            <h2 class="text-xl md:text-2xl font-semibold mb-4">Análisis: Aumentancia</h2>
                            <p class="discord-text-secondary text-sm md:text-base">Exploración de Aumentancia (Reproducción).</p>
                        </div>
                    </div>
                </div></div><div id="content-practica" class="content-section hidden">
                 <div class="border-b border-[var(--border-color)] mb-4 tab-nav-container">
                    <nav class="-mb-px flex space-x-4 md:space-x-6" aria-label="Tabs">
                        <button data-target="subcontent-oracion-practica" class="tab-button active whitespace-nowrap py-3 px-2 font-medium text-xs sm:text-sm">
                           <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-messages-square inline mr-1"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4V4c0-1.1.9-2 2-2h8a2 2 0 0 1 2 2v5Z"/><path d="M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h2Z"/></svg> Oración (Pedir)
                        </button>
                        <button data-target="subcontent-recibx-practica" class="tab-button whitespace-nowrap py-3 px-2 font-medium text-xs sm:text-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-walk inline mr-1"><circle cx="12" cy="5" r="1"/><path d="M9 12l-2.5 4M15 12l2.5 4"/><path d="M12 22v-6"/><path d="M15 13l-3-4-3 4"/></svg> Recibx (Acción/Vivencia)
                        </button>
                         <button data-target="subcontent-aplic-mant-practica" class="tab-button whitespace-nowrap py-3 px-2 font-medium text-xs sm:text-sm">
                           <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layers inline mr-1"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.57 3.91a2 2 0 0 0 1.66 0l8.57-3.9a1 1 0 0 0 0-1.84Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg> App: Mantenencia
                        </button>
                         <button data-target="subcontent-aplic-aum-practica" class="tab-button whitespace-nowrap py-3 px-2 font-medium text-xs sm:text-sm">
                           <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up-right inline mr-1"><path d="M7 7h10v10"/><path d="M7 17 17 7"/></svg> App: Aumentancia
                        </button>
                    </nav>
                </div>
                 <div id="practica-subcontent-container" class="space-y-6">
                     <div id="subcontent-oracion-practica" class="subcontent visible">
                         <div class="discord-card rounded-lg p-4 md:p-6 shadow">
                            <h2 class="text-xl md:text-2xl font-semibold mb-4">Oración (Pedir)</h2>
                            <p class="discord-text-secondary text-sm md:text-base">Espacio para guías, oración libre, diario...</p>
                            </div>
                    </div>
                     <div id="subcontent-recibx-practica" class="subcontent hidden">
                         <div class="discord-card rounded-lg p-4 md:p-6 shadow">
                            <h2 class="text-xl md:text-2xl font-semibold mb-4">Recibx (Acción / Vivencia)</h2>
                            <p class="discord-text-secondary text-sm md:text-base">Registro de acciones, aplicación práctica...</p>
                            </div>
                    </div>
                     <div id="subcontent-aplic-mant-practica" class="subcontent hidden">
                        <div class="discord-card rounded-lg p-4 md:p-6 shadow">
                            <h2 class="text-xl md:text-2xl font-semibold mb-4">Aplicación: Mantenencia</h2>
                            <p class="discord-text-secondary text-sm md:text-base">Reflexiones y acciones sobre Mantenencia.</p>
                            </div>
                    </div>
                     <div id="subcontent-aplic-aum-practica" class="subcontent hidden">
                         <div class="discord-card rounded-lg p-4 md:p-6 shadow">
                            <h2 class="text-xl md:text-2xl font-semibold mb-4">Aplicación: Aumentancia</h2>
                            <p class="discord-text-secondary text-sm md:text-base">Reflexiones y acciones sobre Aumentancia.</p>
                            </div>
                    </div>
                 </div></div><div id="content-social" class="content-section hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div id="social-teoria-container" class="discord-card rounded-lg p-4 md:p-6 shadow">
                        <h2 class="text-xl md:text-2xl font-semibold mb-4 flex items-center">
                           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-graduation-cap mr-2"><path d="M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.084a1 1 0 0 0 0 1.838l8.57 3.908a2 2 0 0 0 1.66 0l8.59-3.908Z"/><path d="M6 12v5c0 1.66 4 3 6 3s6-1.34 6-3v-5"/></svg>
                            Social Teoría
                        </h2>
                        <div class="space-y-4">
                            <div id="competencias-teoricas" class="bg-gray-700/50 rounded-lg p-4">
                                <h3 class="text-lg font-semibold mb-3">Competencias Teóricas</h3>
                                <div class="competencias-list space-y-2">
                                    <p class="text-xs text-gray-400">Placeholder para lista de competencias teóricas...</p>
                                </div>
                            </div>
                            </div>
                    </div>

                    <div id="social-practica-container" class="discord-card rounded-lg p-4 md:p-6 shadow">
                        <h2 class="text-xl md:text-2xl font-semibold mb-4 flex items-center">
                           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-check mr-2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></svg>
                            Social Práctica
                        </h2>
                        <div class="space-y-4">
                            <div id="competencias-practicas" class="bg-gray-700/50 rounded-lg p-4">
                                <h3 class="text-lg font-semibold mb-3">Competencias Prácticas</h3>
                                <div class="competencias-list space-y-2">
                                     <p class="text-xs text-gray-400">Placeholder para lista de competencias prácticas...</p>
                                </div>
                                <button class="add-competencia-btn mt-4 w-full discord-button-secondary text-xs py-1">+ Añadir Competencia</button>
                            </div>
                             <div id="eventos-sociales" class="bg-gray-700/50 rounded-lg p-4">
                                <h3 class="text-lg font-semibold mb-3">Eventos</h3>
                                <div class="eventos-list space-y-2">
                                     <p class="text-xs text-gray-400">Placeholder para lista de eventos...</p>
                                </div>
                                 <button class="add-evento-btn mt-4 w-full discord-button-secondary text-xs py-1">+ Crear Evento</button>
                            </div>
                            </div>
                    </div>
                </div>
            </div><div id="filter-detail-view" class="content-section hidden">
                <div class="discord-card rounded-lg shadow">
                    <div class="filter-detail-header">
                        <div class="flex items-center space-x-2">
                             <button id="back-from-filter-detail" class="discord-button-secondary p-1 rounded">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                             </button>
                             <div id="filter-detail-breadcrumbs">
                                </div>
                        </div>
                        <button id="toggle-breadcrumbs-btn-detail" title="Mostrar/Ocultar Ruta" class="discord-button-secondary p-1 rounded">
                           <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-git-branch-plus"><line x1="6" x2="6" y1="3" y2="15"/><circle cx="18" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><path d="M18 9a9 9 0 0 1-9 9"/></svg>
                        </button>
                    </div>
                    <div class="p-4 md:p-6 space-y-4">
                        <h2 id="filter-detail-title" class="text-xl md:text-2xl font-semibold">Detalle del Filtro: [Nombre Filtro]</h2>

                        <div class="filter-detail-section">
                             <details class="group" open>
                                <summary class="flex justify-between items-center cursor-pointer list-none py-2">
                                    <span class="font-medium">Categorías con Referencias Comunes</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down transition-transform duration-300 group-open:rotate-180"><path d="m6 9 6 6 6-6"/></svg>
                                </summary>
                                <div class="pl-4 pt-2 discord-text-secondary text-sm">
                                    <p class="italic">Placeholder: Aquí se mostrarían otras categorías de filtros (Quienes, Ques, Movimiento, Mantenencia, etc.) que comparten referencias con el filtro actual. La lógica para esto es compleja y requiere backend.</p>
                                    <ul>
                                        <li>- Categoría Relacionada 1 (X refs)</li>
                                        <li>- Categoría Relacionada 2 (Y refs)</li>
                                    </ul>
                                </div>
                            </details>
                        </div>

                        <div class="filter-detail-section">
                             <h3 class="font-medium mb-3">Resultados Encontrados</h3>
                             <div class="border-b border-[var(--border-color)] mb-3 tab-nav-container">
                                <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                                     <button data-target="filter-results-verses" class="tab-button active whitespace-nowrap py-2 px-1 font-medium text-xs sm:text-sm">
                                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-marked inline mr-1"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/><polyline points="10 2 10 10 13 7 16 10 16 2"/></svg> Versos/Capítulos (Refs)
                                     </button>
                                     <button data-target="filter-results-words" class="tab-button whitespace-nowrap py-2 px-1 font-medium text-xs sm:text-sm">
                                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scan-text inline mr-1"><path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M21 17v2a2 2 0 0 1-2 2h-2"/><path d="M7 21H5a2 2 0 0 1-2-2v-2"/><path d="M7 12h10"/></svg> Palabras/Frases/Ideas (Refs)
                                     </button>
                                </nav>
                             </div>
                             <div>
                                 <div id="filter-results-verses" class="filter-results-content visible">
                                     <p class="discord-text-secondary text-sm italic">Placeholder: Lista de referencias (ej. Jn 3:16, Sal 23) que coinciden con el filtro. Funcionalidad requiere backend.</p>
                                     <div class="mt-2 flex space-x-2">
                                         <button class="discord-button-secondary text-xs px-2 py-1">Copiar Refs</button>
                                         <button class="discord-button-secondary text-xs px-2 py-1">Seleccionar Todo</button>
                                     </div>
                                 </div>
                                 <div id="filter-results-words" class="filter-results-content hidden">
                                     <p class="discord-text-secondary text-sm italic">Placeholder: Lista de palabras/frases/ideas clave relacionadas con el filtro. Funcionalidad requiere backend.</p>
                                      <div class="mt-2 flex space-x-2">
                                         <button class="discord-button-secondary text-xs px-2 py-1">Copiar Refs</button>
                                         <button class="discord-button-secondary text-xs px-2 py-1">Seleccionar Todo</button>
                                     </div>
                                 </div>
                             </div>
                        </div>
                    </div>
                </div>
             </div></div> <div id="checkin-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50 hidden">
             <div class="discord-card rounded-lg p-6 md:p-8 shadow-xl max-w-md w-full">
                 <h2 class="text-lg md:text-xl font-semibold mb-4">Check-in Diario de Oración</h2>
                 <p class="discord-text-secondary mb-4 text-sm md:text-base">Modo: <span class="font-medium text-cyan-400">Relación Establecida</span></p>
                 <p class="discord-text-secondary mb-4 text-sm md:text-base">Reflexiona y ora sobre la <span class="font-semibold text-red-400">Sangre</span> y el <span class="font-semibold text-blue-400">Agua</span> hoy.</p>
                 <div class="mb-4">
                    <label class="block text-xs md:text-sm font-medium discord-text-secondary mb-1">Breve oración/reflexión:</label>
                    <textarea rows="3" class="w-full p-2 discord-input rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--bg-primary)] discord-text-primary text-sm md:text-base"></textarea>
                 </div>
                 <div class="flex justify-end space-x-2 md:space-x-3">
                     <button id="close-checkin-modal" class="px-3 py-1 md:px-4 md:py-2 rounded-lg discord-button-secondary text-xs md:text-sm">Cerrar</button>
                     <button class="px-3 py-1 md:px-4 md:py-2 rounded-lg discord-button-primary text-xs md:text-sm">Completar</button>
                 </div>
            </div>
        </div>

    </main>

    <script>
        // --- Utilidades (Helpers) ---
        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);
        const generateUniqueId = () => `id_${Date.now().toString(36)}_${Math.random().toString(36).substr(2, 5)}`;

        // --- Elementos del DOM ---
        const navButtons = $$('.nav-button');
        const contentSections = $$('.content-section'); // Secciones principales + filter-detail-view
        const mainContentArea = $('#main-content-area'); // Contenedor de secciones normales
        const filterDetailView = $('#filter-detail-view'); // Vista de detalle del filtro
        const mainTitle = $('#main-title');
        const breadcrumbsContainer = $('#breadcrumbs-container');
        const breadcrumbPathEl = $('#breadcrumb-path');
        const toggleBreadcrumbsBtn = $('#toggle-breadcrumbs-btn'); // Botón para ocultar/mostrar breadcrumbs
        const checkinModal = $('#checkin-modal');
        const showCheckinBtn = $('#show-checkin-modal');
        const closeCheckinBtn = $('#close-checkin-modal');
        const socialGeneralBtn = $('#social-general-btn');
        const socialTeoriaBtn = $('#social-teoria-btn');
        const socialPracticaBtn = $('#social-practica-btn');

        // --- Estado de la Aplicación ---
        let appState = {
            currentMainSectionId: 'content-inicio',
            currentSubSectionId: null, // Para saber qué tab está activa
            isFilterDetailVisible: false,
            currentFilterDetail: null, // Guarda info del filtro activo en detalle
            breadcrumbsVisible: false, // Breadcrumbs ocultos por defecto
            filterCollapseState: {} // Guarda el estado plegado/desplegado de filtros
        };

        // --- Funciones de Navegación ---
        function navigateToSection(targetId, subTargetId = null) {
            if (!targetId) return;

            appState.isFilterDetailVisible = false; // Salir de la vista de detalle por defecto
            filterDetailView.classList.add('hidden');
            mainContentArea.classList.remove('hidden'); // Asegurar que el área principal esté visible

            // Determinar el botón de la barra lateral correspondiente
            let sidebarButtonId = targetId.replace('content-', 'nav-');

            // Mostrar/Ocultar secciones principales
            let sectionChanged = (targetId !== appState.currentMainSectionId);
            if (sectionChanged) {
                 contentSections.forEach(section => {
                    // Ocultar todas excepto la de detalle (que ya está oculta) y la target
                    if (section.id !== 'filter-detail-view') {
                         section.classList.toggle('hidden', section.id !== targetId);
                    }
                 });
                 appState.currentMainSectionId = targetId;

                 // Actualizar botones de barra lateral
                 navButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.id === sidebarButtonId);
                 });

                 // Actualizar título principal
                 const activeNavButton = $(`#${sidebarButtonId}`);
                 if (activeNavButton) {
                     mainTitle.textContent = activeNavButton.title;
                 }
                 // Ocultar breadcrumbs al cambiar de sección principal
                 setBreadcrumbsVisibility(false);
            }

             // Actualizar visibilidad de botones sociales
             updateSocialButtonsVisibility();

             // Activar/Resetear tabs internas
             const targetSectionEl = $(`#${targetId}`);
             if (targetSectionEl) {
                 const tabs = targetSectionEl.querySelectorAll('.tab-button');
                 const subcontents = targetSectionEl.querySelectorAll('.subcontent');

                 if (tabs.length > 0) {
                     let targetTab = null;
                     let targetSubcontentId = null;

                     if (subTargetId) {
                         targetTab = targetSectionEl.querySelector(`[data-target="${subTargetId}"]`);
                         targetSubcontentId = subTargetId;
                     }
                     // Si no hay subTargetId o no se encontró, o si cambiamos de sección principal, activar la primera tab
                     if (!targetTab || sectionChanged) {
                         targetTab = tabs[0];
                         targetSubcontentId = targetTab?.getAttribute('data-target');
                     }

                     if (targetTab && targetSubcontentId) {
                         tabs.forEach(t => t.classList.remove('active'));
                         subcontents.forEach(sc => sc.classList.add('hidden'));
                         targetTab.classList.add('active');
                         $(`#${targetSubcontentId}`)?.classList.remove('hidden');
                         appState.currentSubSectionId = targetSubcontentId;
                     } else {
                         // Si no hay tabs o subcontenido, limpiar estado
                         appState.currentSubSectionId = null;
                     }
                 } else {
                    appState.currentSubSectionId = null; // No hay tabs en esta sección
                 }
             } else {
                appState.currentSubSectionId = null;
             }
             updateBreadcrumbs(); // Actualizar breadcrumbs después de la navegación
        }

        function showFilterDetailView(filterId, filterName) {
            appState.isFilterDetailVisible = true;
            appState.currentFilterDetail = { id: filterId, name: filterName };

            mainContentArea.classList.add('hidden'); // Ocultar contenido principal
            filterDetailView.classList.remove('hidden'); // Mostrar vista de detalle

            // Actualizar título y breadcrumbs para la vista de detalle
            mainTitle.textContent = `Filtro: ${filterName}`;
            updateBreadcrumbs();
            setBreadcrumbsVisibility(true); // Mostrar breadcrumbs en esta vista

            // Simular carga de datos (placeholders)
            $('#filter-detail-title').textContent = `Detalle del Filtro: ${filterName}`;
            console.log(`Mostrando detalle para filtro: ${filterId}`);
            // Aquí iría la lógica para cargar referencias comunes y resultados
        }

        function hideFilterDetailView() {
             // Volver a la sección anterior (Teoría, donde están los filtros)
             navigateToSection('content-teoria', 'subcontent-filtros');
        }

        function updateSocialButtonsVisibility() {
            const showGeneral = appState.currentMainSectionId === 'content-inicio';
            const showTeoria = appState.currentMainSectionId === 'content-teoria';
            const showPractica = appState.currentMainSectionId === 'content-practica';

            socialGeneralBtn?.classList.toggle('hidden', !showGeneral);
            socialTeoriaBtn?.classList.toggle('hidden', !showTeoria);
            socialPracticaBtn?.classList.toggle('hidden', !showPractica);
        }

        function updateBreadcrumbs() {
            let path = '';
            const mainSectionTitle = $(`#${appState.currentMainSectionId.replace('content-','nav-')}`)?.title || 'Inicio';

            if (appState.isFilterDetailVisible && appState.currentFilterDetail) {
                // Breadcrumbs para vista de detalle de filtro
                path = `<span class="breadcrumb-item"><a class="breadcrumb-link" onclick="navigateToSection('content-teoria', 'subcontent-filtros')">Teoría</a></span>`;
                path += `<span class="breadcrumb-item"><a class="breadcrumb-link" onclick="navigateToSection('content-teoria', 'subcontent-filtros')">Filtros Analíticos</a></span>`;
                path += `<span class="breadcrumb-item"><span class="breadcrumb-current">${appState.currentFilterDetail.name}</span></span>`;
                mainTitle.classList.add('hidden'); // Ocultar título principal
                breadcrumbsContainer.classList.remove('hidden');
            } else if (appState.currentMainSectionId !== 'content-inicio') {
                // Breadcrumbs para secciones principales (excepto inicio)
                path = `<span class="breadcrumb-item"><span class="breadcrumb-current">${mainSectionTitle}</span></span>`;
                 // Añadir tab activa si existe
                 if(appState.currentSubSectionId){
                    const activeTab = $(`#${appState.currentMainSectionId} [data-target="${appState.currentSubSectionId}"]`);
                    if(activeTab){
                         path += `<span class="breadcrumb-item"><span class="breadcrumb-current">${activeTab.textContent.trim()}</span></span>`;
                    }
                 }
                 mainTitle.classList.remove('hidden'); // Mostrar título principal
                 breadcrumbsContainer.classList.add('hidden'); // Ocultar breadcrumbs por defecto fuera de detalle
            } else {
                // En Inicio, no mostrar breadcrumbs
                 mainTitle.classList.remove('hidden');
                 breadcrumbsContainer.classList.add('hidden');
            }

            breadcrumbPathEl.innerHTML = path;
            // Actualizar visibilidad del botón de toggle breadcrumbs
            toggleBreadcrumbsBtn?.classList.toggle('hidden', !appState.isFilterDetailVisible);
        }

         function setBreadcrumbsVisibility(visible) {
            appState.breadcrumbsVisible = visible;
            breadcrumbsContainer?.classList.toggle('hidden', !visible);
            mainTitle?.classList.toggle('hidden', visible); // Ocultar título si breadcrumbs visibles
         }


        // --- Event Listeners ---
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                let targetId = button.id.replace('nav-', 'content-');
                navigateToSection(targetId);
            });
        });

         // Navegación por Tabs Internas
         $$('#content-teoria .tab-button, #content-practica .tab-button').forEach(tab => {
             tab.addEventListener('click', (event) => {
                 event.stopPropagation();
                 const targetSubcontentId = tab.getAttribute('data-target');
                 const parentSectionId = tab.closest('.content-section').id;
                 navigateToSection(parentSectionId, targetSubcontentId);
             });
         });

         // Filtros Analíticos Interactivo
         function initializeFilterInteraction() {
             $$('#filtros-lista-container .filtro-header').forEach(header => {
                 const filterCard = header.closest('.filtro-card');
                 const filterId = filterCard?.dataset.id || 'unknown';
                 const filterName = header.querySelector('span')?.textContent || 'Filtro';
                 const content = header.nextElementSibling;
                 const icon = header.querySelector('.lucide-chevron-down');

                 header.addEventListener('click', (e) => {
                     // Prevenir que el evento de expandir/colapsar interfiera si queremos abrir detalle
                     // Podríamos tener un botón específico para "Ver detalle"
                     // Por ahora, simulamos que el clic abre el detalle
                     showFilterDetailView(filterId, filterName);

                     // Lógica original de expandir/colapsar (la dejamos comentada o la eliminamos si el clic siempre va a detalle)
                     /*
                     if (content) {
                         const isExpanded = !content.classList.contains('hidden');
                         content.classList.toggle('hidden');
                         header.classList.toggle('expanded', !isExpanded);
                         icon?.classList.toggle('rotate-180', !isExpanded);
                         // Guardar estado
                         appState.filterCollapseState[filterId] = !isExpanded;
                         sessionStorage.setItem('filterCollapseState', JSON.stringify(appState.filterCollapseState));
                     }
                     */
                 });

                 // Restaurar estado plegado/desplegado de sessionStorage (si existiera la lógica de toggle)
                 /*
                 const savedState = appState.filterCollapseState[filterId];
                 if (content && savedState !== undefined) {
                     content.classList.toggle('hidden', !savedState);
                     header.classList.toggle('expanded', savedState);
                     icon?.classList.toggle('rotate-180', savedState);
                 } else if (content) {
                     // Por defecto, colapsado
                     content.classList.add('hidden');
                     header.classList.remove('expanded');
                     icon?.classList.remove('rotate-180');
                 }
                 */
                 // Por defecto, colapsado al inicio
                 if (content) content.classList.add('hidden');
                 if (icon) icon.classList.remove('rotate-180');


             });
         }

         // Botón para volver desde detalle de filtro
         $('#back-from-filter-detail')?.addEventListener('click', hideFilterDetailView);

         // Tabs dentro de la vista de detalle de filtro
         $$('#filter-detail-view .tab-button').forEach(tab => {
             tab.addEventListener('click', (event) => {
                 event.stopPropagation();
                 const container = tab.closest('#filter-detail-view');
                 const tabs = container.querySelectorAll('.tab-button');
                 const contents = container.querySelectorAll('.filter-results-content');
                 const targetId = tab.getAttribute('data-target');

                 tabs.forEach(t => t.classList.remove('active'));
                 tab.classList.add('active');
                 contents.forEach(c => c.classList.toggle('hidden', c.id !== targetId));
             });
         });

         // Agua System Elementos (Placeholder Interactivo)
         function initializeAguaInteraction() {
             // Listener para añadir elementos (simulado)
             $$('.add-agua-elemento-btn').forEach(button => {
                 button.addEventListener('click', () => {
                     const columna = button.dataset.columna;
                     const container = $(`.agua-columna [data-columna="${columna}"] .agua-elementos-container`);
                     if (container) {
                         const newElement = document.createElement('div');
                         newElement.className = 'agua-elemento';
                         newElement.dataset.id = generateUniqueId();
                         newElement.textContent = `Nuevo ${columna} ${Math.floor(Math.random() * 100)}`;
                         newElement.addEventListener('click', () => {
                            alert(`Elemento clickeado: ${newElement.textContent}. Aquí se abriría detalle.`);
                         });
                         container.appendChild(newElement);
                         console.log(`Añadido elemento a ${columna}`);
                     }
                 });
             });
             // Listener para clics en elementos existentes (simulado)
             $$('.agua-elemento').forEach(elemento => {
                 elemento.addEventListener('click', () => {
                     alert(`Elemento clickeado: ${elemento.textContent}. Aquí se abriría detalle.`);
                 });
             });
             // Nota: Drag and drop requeriría una librería como SortableJS y lógica adicional.
         }


        // Modal Check-in
        if (showCheckinBtn) showCheckinBtn.addEventListener('click', () => checkinModal?.classList.remove('hidden'));
        if (closeCheckinBtn) closeCheckinBtn.addEventListener('click', () => checkinModal?.classList.add('hidden'));
        if (checkinModal) checkinModal.addEventListener('click', (event) => { if (event.target === checkinModal) checkinModal.classList.add('hidden'); });

        // Toggle Breadcrumbs
        if(toggleBreadcrumbsBtn){
            toggleBreadcrumbsBtn.addEventListener('click', () => {
                setBreadcrumbsVisibility(!appState.breadcrumbsVisible);
            });
        }

        // --- Lógica Memorización (Sin cambios funcionales) ---
        const citationEl = $('#citation');
        const verseInput = $('#verseInput');
        const checkBtn = $('#checkBtn');
        const revealBtn = $('#revealBtn');
        const resultArea = $('#resultArea');
        const userAnswerEl = $('#userAnswer');
        const correctAnswerEl = $('#correctAnswer');
        const diffOutputEl = $('#diffOutput');
        const srsButtons = $$('.srs-btn');
        const srsFeedbackEl = $('#srsFeedback');
        const currentVerse = { citation: "Juan 3:16", text: "Porque de tal manera amó Dios al mundo, que ha dado a su Hijo unigénito, para que todo aquel que en él cree, no se pierda, mas tenga vida eterna." };
        let correctText = currentVerse.text;
        // ... (funciones simpleDiff, checkAnswer, revealAnswer, handleSrsSelection - sin cambios) ...
        function simpleDiff(text1, text2) { const normalize = (str) => str.toLowerCase().replace(/[.,;:]$/g, '').replace(/\s+/g, ' ').trim(); const norm1 = normalize(text1); const norm2 = normalize(text2); if (norm1 === norm2) return '<span class="highlight-correct">¡Perfecto!</span>'; const words1 = norm1.split(' '); const words2 = norm2.split(' '); let resultHtml = ''; let i = 0, j = 0; while (i < words1.length || j < words2.length) { if (i < words1.length && j < words2.length && words1[i] === words2[j]) { resultHtml += `<span class="highlight-correct">${words2[j]}</span> `; i++; j++; } else if (j < words2.length) { let found = false; for(let k = i; k < Math.min(i + 3, words1.length); k++) { if(words1[k] === words2[j]) { for (let m = i; m < k; m++) resultHtml += `<span class="highlight-missing">(${words1[m]})</span> `; resultHtml += `<span class="highlight-correct">${words2[j]}</span> `; i = k + 1; j++; found = true; break; } } if (!found) { resultHtml += `<span class="highlight-incorrect">${words2[j]}</span> `; if (i < words1.length) { resultHtml += `<span class="highlight-missing">(${words1[i]})</span> `; i++; } j++; } } else if (i < words1.length) { resultHtml += `<span class="highlight-missing">(${words1[i]})</span> `; i++; } else { break; } } return resultHtml.trim(); }
        function checkAnswer() { const userAnswer = verseInput ? verseInput.value : ''; if (!userAnswerEl || !correctAnswerEl || !diffOutputEl || !resultArea) return; const diffHtml = simpleDiff(correctText, userAnswer); userAnswerEl.textContent = userAnswer || "(Vacío)"; correctAnswerEl.textContent = correctText; diffOutputEl.innerHTML = diffHtml; resultArea.classList.remove('hidden'); if (srsFeedbackEl) srsFeedbackEl.textContent = ''; }
        function revealAnswer() { alert(`El texto correcto es:\n\n${correctText}`); if (verseInput) verseInput.value = correctText; }
        function handleSrsSelection(rating) { if (!srsFeedbackEl) return; let feedback = `Calificación ${rating} registrada. `; switch(rating) { case 1: feedback += "Se revisará pronto."; break; case 2: feedback += "Se programará revisión cercana."; break; case 3: feedback += "Buen trabajo. Intervalo aumentará."; break; case 4: feedback += "¡Excelente! Intervalo aumentará mucho."; break; } srsFeedbackEl.textContent = feedback; console.log(`SRS Rating: ${rating}`); }
        if (checkBtn) checkBtn.addEventListener('click', checkAnswer);
        if (revealBtn) revealBtn.addEventListener('click', revealAnswer);
        if (citationEl) citationEl.addEventListener('click', revealAnswer);
        if (srsButtons) srsButtons.forEach(button => button.addEventListener('click', () => handleSrsSelection(parseInt(button.getAttribute('data-rating')))));


        // --- Inicialización General ---
        function initializeApp() {
            // Cargar estado de filtros plegados
            const savedFilterState = sessionStorage.getItem('filterCollapseState');
            appState.filterCollapseState = savedFilterState ? JSON.parse(savedState) : {};

            // Generar filtros dinámicamente (ejemplo)
            generateFilters(); // Asegúrate que esta función exista y genere los filtros
            initializeFilterInteraction(); // Añadir listeners a los filtros generados
            initializeAguaInteraction(); // Añadir listeners a elementos Agua

            navigateToSection('content-inicio'); // Cargar vista inicial
            console.log("App inicializada.");
        }

        // Función para generar filtros (ejemplo básico)
        function generateFilters() {
            const container = $('#filtros-lista-container');
            if (!container) return;
            container.innerHTML = ''; // Limpiar
            const filtros = [
                { id: 'f-quienes', name: 'Quienes (Personx)', sub: ['Diferencias Y', 'Diferencias X'] },
                { id: 'f-ques', name: 'Ques', sub: [] },
                { id: 'f-movimiento', name: 'Movimiento', sub: ['Edad'] },
                { id: 'f-mantenencia', name: 'Mantenencia', sub: [] },
                { id: 'f-aumentancia', name: 'Aumentancia', sub: [] },
                { id: 'f-sangre', name: 'Sangre', sub: [] },
                { id: 'f-agua', name: 'Agua', sub: [] },
            ];

            filtros.forEach(f => {
                const card = document.createElement('div');
                card.className = 'filtro-card';
                card.dataset.id = f.id;
                card.innerHTML = `
                    <div class="filtro-header">
                        <span><i class="lucide">filter</i> ${f.name}</span>
                        <i class="lucide lucide-chevron-down text-sm">chevron-down</i>
                    </div>
                    <div class="filtro-content hidden">
                        <p class="text-xs italic discord-text-muted mb-2">Haz clic para ver detalle (simulado).</p>
                        ${f.sub.length > 0 ? '<h4 class="text-xs font-medium discord-text-secondary mb-1">Subcategorías:</h4>' : ''}
                        <ul class="pl-2 space-y-1">
                            ${f.sub.map(s => `<li class="text-xs discord-text-secondary">- ${s}</li>`).join('')}
                        </ul>
                         </div>
                `;
                container.appendChild(card);
            });
        }


        // Ejecutar inicialización cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>
</body>
</html>
